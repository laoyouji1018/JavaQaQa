# TCP四次挥手为什么是四次？可以三次吗？

### 一、TCP三次握手、四次挥手

我们先回顾TCP三次握手、四次挥手的过程。

1、三次握手：

Client：请求连接；
Server：同意并请求连接；
Client：同意。
2、四次挥手：

Client：请求关闭；
Server：同意；
【Server：…（可能在继续发未发完的数据/也可能没有）】
Server：请求关闭；
Client：同意。

### 二、握手挥手间的实质与差别

1、实质

socket_pair：一个socket管理两个缓冲区（发送缓冲区/发送端与接收缓冲区/接收端）。
请求连接/关闭：是自身发送端与对方接收端的申请建立连接/关闭的过程。
2、差别

（1）三次握手：第二次握手时，服务器端同意客户端的连接请求的同时，进行服务器端的连接请求。

（2）四次挥手：第二次握手时，服务器端仅同意客户端的关闭请求；在第三次握手时，才进行服务器端的关闭请求。

### 三、四次挥手可以改成三次吗？

我自己思考觉得在某些情况下是可以的，但普遍情况是不行。

四次挥手把同意对方请求跟自身请求分离开。是因为在客户端请求断开时（客户端发送端->服务器接收端），服务器可能还有数据未发完，所以需要分开操作：

先同意对方关闭连接，对方无法传输数据；（第二次挥手）
自己若还有数据未发送完，接着发送直至全部发送完毕；
请求自身关闭连接；（第三次挥手）
也就是说，三次握手、四次挥手差别就在第二次，有没有把同意对方请求跟自身请求拆分开。

如果客户端请求关闭连接时，服务器并没有数据需要发送，其实三次挥手应该也是可以的。但一般情况下，客户端猝不及防地请求断开连接，服务器还是有数据需要传输的，所以四次挥手更加地稳妥。
————————————————
版权声明：本文为CSDN博主「liuwp5」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。
原文链接：https://blog.csdn.net/liuwp5/article/details/113738350