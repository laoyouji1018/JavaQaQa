# MySQL唯一索引和普通索引的区别

## 查询和更新上的区别

### 查询操作

这两类索引在查询上差别不大，主要是更新上的差别。

查询的时候

- 普通索引：查找到第一条满足条件的记录后，继续向后遍历，直到第一个不满足条件的记录。
- 唯一索引：由于索引定义了唯一性，查找到第一条满足条件的记录后，直接停止继续检索。

> 普通索引会多检索一次，几乎没什么影响。因为InnDB是按照数据页为单位去读取数据的， 需要读取数据时，并不是直接去磁盘中读取的数据，而是读取数据页到内存，然后再从数据页中检索数据。每个数据页是16kb，对整型字段，一个数据页可以存放近1000个key,除非要读取的数据正好在数据页的最后一条记录，就需要重新再去读一个数据页，这种情况很少，对CPU的消耗基本可以忽略。因此，这两类索引在查询上的区别基本没差别。

### 更新操作

更新操作并不是直接对磁盘中的数据进行更新，而是把数据页从磁盘读到内存，再更新数据页。

- 普通索引：以数据页为单位，把数据从磁盘读到内存，然后更新内存中的数据。
- 唯一索引：以数据页为单位，把数据从磁盘督导内存，判断是否唯一再更新内存中的数据。

> mysql中有个change buffer机制，普通索引可以用chang buffer,唯一索引用不了。chang buffer 的作用是 降低IO操作，chang buffer 将数据写入数据页的操作叫做merge。
>
> - 普通索引，如果需要更新的数据页在内存中，则直接更新数据页，如果不在，则会先将操作记录到change buffer，当下次读取数据页是，顺带merge到数据页中，change buffer也有定期merge策略。数据库正常关闭时，也会触发merge。
>
> - 唯一索引，更新前需要先判断数据是否唯一。如果数据页在内存中 就可以直接判断并更新，如果不在内存中，则需要从磁盘中读出来，再判断更新，所以用不到change buffer.



**扩展**：change buffer 用的是buffer pool里的内存，因此不能无限增大，change buffer 的大小可以通过参数inndb_change_buffer_max_size来动态设。例如这个参数设置的是50时，表示change buffer 的大小最多只能占用 change pool 的 50%。
**总结**：mysql 唯一索引和普通索引 在读操作上基本没有什么差别，只是普通索引比唯一索引多检索一次，几乎没什么影响。在写操作上有区别。两种类型的索引在写操作时都是 把数据页先从磁盘读到内存，再更新，但唯一索引更新前会判断数据是否唯一再更新，并且当数据页不在内存中时，普通索引能用 change buffer 先记录更新操作，等下次再读数据页时，顺带merge到数据页，而唯一索引是 需要从磁盘中读取数据页后判断是否唯一再更新，用不到change buffer.